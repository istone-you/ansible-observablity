---
  - name: Download OtelCollector
    get_url:
        url: https://github.com/open-telemetry/opentelemetry-collector-releases/releases/download/v{{ otel_version }}/otelcol-contrib_{{ otel_version }}_linux_amd64.rpm
        dest: /tmp

  - name: Install OtelCollector
    shell: rpm -Uvh /tmp/otelcol-contrib_{{ otel_version }}_linux_amd64.rpm

  - name: Remove RPM File
    file:
      path: /tmp/otelcol-contrib_{{ otel_version }}_linux_amd64.rpm
      state: absent

  - name: Start OtelCollector
    shell: /opt/aws/aws-otel-collector/bin/aws-otel-collector-ctl -a start

  - name: Configure OtelCollector
    template:
      src: config.yaml.j2
      dest: /opt/aws/aws-otel-collector/etc/config.yaml

  - name: Restart OtelCollector
    systemd:
      name: aws-otel-collector.service
      state: restarted